<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAVFIT Infinity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom scrollbar for better aesthetics in the waterfall */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          Anchor, 
          Infinity, 
          Menu, 
          User, 
          Users, 
          TrendingUp, 
          Calendar, 
          FileText, 
          Settings, 
          ChevronDown, 
          ChevronRight, 
          LogOut, 
          Plus, 
          AlertCircle,
          ArrowRight
        } from 'lucide-react';

        // --- Mock Data & Constants ---

        const MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const CURRENT_YEAR = 2025;
        const CO_DETACH_DATE = '2025-09-15'; // Change of Reporting Senior Date

        // Periodic Schedule Lookup
        const PERIODIC_SCHEDULE = {
          'O-6': 7, // July
          'O-5': 4, // April
          'O-4': 10, // Oct
          'O-3': 1, // Jan
          'O-2': 2, // Feb
          'O-1': 5, // May
          'E-9': 4, // Apr
          'E-8': 9, // Sep
          'E-7': 9, // Sep
          'E-6': 11, // Nov
          'E-5': 3, // Mar
          'E-4': 6, // June
        };

        // Mock Members Data
        const INITIAL_MEMBERS = [
          // O-3 1110 (SWO)
          { id: 1, name: 'LT Mitchell, P.', rank: 'O-3', designator: '1110', milestone: 'DIVO', prd: '2026-06-01', lastTrait: 3.8, nextPlan: 4.0, target: 4.2, status: 'Onboard' },
          { id: 2, name: 'LT Kazansky, T.', rank: 'O-3', designator: '1110', milestone: 'DH', prd: '2025-08-15', lastTrait: 4.2, nextPlan: 4.5, target: 4.8, status: 'Onboard' }, // Departing
          { id: 3, name: 'LT Bradshaw, N.', rank: 'O-3', designator: '1110', milestone: 'DIVO', prd: '2027-01-01', lastTrait: 3.6, nextPlan: 3.8, target: 4.0, status: 'Onboard' },
          
          // O-4 1110 (SWO)
          { id: 4, name: 'LCDR Metcalf, M.', rank: 'O-4', designator: '1110', milestone: 'XO', prd: '2026-10-01', lastTrait: 4.5, nextPlan: 4.6, target: 4.8, status: 'Onboard' },
          
          // Gains
          { id: 5, name: 'LTJG Seresin, J.', rank: 'O-2', designator: '1110', milestone: 'TRAINING', prd: '2028-01-01', lastTrait: null, nextPlan: 'NOB', target: 3.5, status: 'Gain', gainDate: '2025-04-01' },

          // E-6
          { id: 6, name: 'PO1 Floyd, B.', rank: 'E-6', rating: 'OS', milestone: 'LPO', prd: '2026-03-15', lastTrait: 3.8, nextPlan: 4.0, target: 4.14, status: 'Onboard' },
          { id: 7, name: 'PO1 Trace, R.', rank: 'E-6', rating: 'BM', milestone: 'LPO', prd: '2025-11-30', lastTrait: 4.0, nextPlan: 4.2, target: 4.3, status: 'Onboard' },
        ];

        // --- Components ---

        const SidebarItem = ({ icon: Icon, label, active, onClick }) => (
          <div 
            onClick={onClick}
            className={`flex items-center space-x-3 px-4 py-3 rounded-lg cursor-pointer transition-colors ${
              active ? 'bg-blue-800 text-yellow-400' : 'text-blue-100 hover:bg-blue-800'
            }`}
          >
            <Icon size={20} />
            <span className="font-medium">{label}</span>
          </div>
        );

        const KPICard = ({ title, value, subtext, trend, color = 'blue' }) => (
          <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <div className="flex justify-between items-start mb-2">
              <h3 className="text-slate-500 text-sm font-semibold uppercase tracking-wider">{title}</h3>
              {trend && (
                <span className={`flex items-center text-xs font-bold ${trend === 'up' ? 'text-green-600' : 'text-red-600'}`}>
                  {trend === 'up' ? '↑' : '↓'}
                </span>
              )}
            </div>
            <div className="text-3xl font-bold text-slate-800 mb-1">{value}</div>
            <div className={`text-xs ${color === 'red' ? 'text-red-500' : 'text-slate-400'}`}>{subtext}</div>
          </div>
        );

        // The Core Waterfall Timeline Component
        const TimelineRow = ({ member, coDetachDate }) => {
          // Helper to calculate position percentage (0-100%) based on month (1-12)
          const getPos = (monthIndex, day = 15) => {
            const totalDays = 12 * 30;
            const currentDays = (monthIndex * 30) + day;
            return (currentDays / totalDays) * 100;
          };

          const periodicMonth = PERIODIC_SCHEDULE[member.rank] || -1;
          const periodicPos = periodicMonth > 0 ? getPos(periodicMonth - 1, 15) : -1;
          
          // Parse Dates
          const detachDateObj = new Date(coDetachDate);
          const coDetachPos = getPos(detachDateObj.getMonth(), detachDateObj.getDate());

          const isTransferring = member.prd && member.prd.startsWith(CURRENT_YEAR.toString());
          const transferDate = isTransferring ? new Date(member.prd) : null;
          const transferPos = transferDate ? getPos(transferDate.getMonth(), transferDate.getDate()) : -1;

          const isGaining = member.status === 'Gain';
          const gainDate = isGaining ? new Date(member.gainDate) : null;
          const gainPos = gainDate ? getPos(gainDate.getMonth(), gainDate.getDate()) : -1;

          return (
            <div className="grid grid-cols-12 gap-4 py-3 border-b border-slate-100 hover:bg-slate-50 items-center">
              {/* Member Info */}
              <div className="col-span-3 pl-4">
                <div className="font-bold text-slate-800 text-sm">{member.name}</div>
                <div className="text-xs text-slate-500 flex items-center space-x-2">
                  <span className="bg-slate-200 px-1.5 rounded text-slate-700 font-mono">{member.rank}</span>
                  <span>{member.designator || member.rating}</span>
                  <span className="text-blue-600 font-semibold">• {member.milestone}</span>
                </div>
              </div>

              {/* Trajectory Stats */}
              <div className="col-span-2 flex flex-col justify-center border-l border-r border-slate-100 px-2">
                <div className="flex items-center justify-between text-xs mb-1">
                  <span className="text-slate-400">Trend</span>
                  <div className="flex items-center space-x-1">
                    <span className="text-slate-400">{member.lastTrait?.toFixed(2) || 'N/A'}</span>
                    <ArrowRight size={10} className="text-slate-300"/>
                    <span className="font-bold text-blue-600">{member.nextPlan === 'NOB' ? 'NOB' : member.nextPlan?.toFixed(2)}</span>
                    <ArrowRight size={10} className="text-slate-300"/>
                    <span className="font-bold text-green-600">{member.target?.toFixed(2)}</span>
                  </div>
                </div>
                <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                  {typeof member.nextPlan === 'number' && (
                     <div 
                       className="h-full bg-blue-500 rounded-full" 
                       style={{ width: `${(member.nextPlan / 5.0) * 100}%` }}
                     ></div>
                  )}
                </div>
              </div>

              {/* The Timeline Visual */}
              <div className="col-span-7 relative h-12 flex items-center pr-4">
                {/* Background Grid Lines (Months) */}
                {MONTHS.map((_, idx) => (
                    <div key={idx} className="absolute h-full border-r border-slate-100 top-0" style={{ left: `${(idx + 1) * 8.33}%` }}></div>
                ))}

                {/* Timeline Track */}
                <div className="absolute w-full h-1 bg-slate-200 rounded top-1/2 -translate-y-1/2"></div>

                {/* 1. Periodic Report Marker */}
                {!isGaining && periodicPos > 0 && (
                  <div 
                    className="absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-blue-500 rounded-full border-2 border-white shadow-sm flex items-center justify-center z-10 group cursor-pointer hover:scale-110 transition-transform"
                    style={{ left: `${periodicPos}%` }}
                    title={`Periodic Report Due: ${MONTHS[periodicMonth-1]}`}
                  >
                    <FileText size={12} className="text-white" />
                    {/* Tooltip */}
                    <div className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-20 pointer-events-none">
                      Periodic: {member.nextPlan}
                    </div>
                  </div>
                )}

                {/* 2. Transfer/Loss Marker */}
                {isTransferring && (
                  <div 
                    className="absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-red-500 rounded-full border-2 border-white shadow-sm flex items-center justify-center z-10 group cursor-pointer"
                    style={{ left: `${transferPos}%` }}
                    title={`Transfer PRD: ${member.prd}`}
                  >
                    <LogOut size={12} className="text-white ml-0.5" />
                     <div className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-20 pointer-events-none">
                      Transfer: Detach Report
                    </div>
                  </div>
                )}

                {/* 3. Gain Marker */}
                {isGaining && (
                  <div 
                    className="absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-green-500 rounded-full border-2 border-white shadow-sm flex items-center justify-center z-10 group cursor-pointer"
                    style={{ left: `${gainPos}%` }}
                    title={`Gain Date: ${member.gainDate}`}
                  >
                    <Plus size={12} className="text-white" />
                     <div className="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-20 pointer-events-none">
                      Gain: {member.gainDate}
                    </div>
                  </div>
                )}

                {/* 4. CO Detachment Line (Change of Reporting Senior) */}
                {/* Only show if the member is onboard during this time */}
                {(!isGaining || gainPos < coDetachPos) && (!isTransferring || transferPos > coDetachPos) && (
                     <div 
                     className="absolute h-full w-0.5 bg-purple-500 top-0 z-0 opacity-60 dashed"
                     style={{ left: `${coDetachPos}%`, borderLeft: '2px dashed #a855f7' }}
                   >
                      <div className="absolute top-1/2 -translate-y-1/2 -left-2.5 w-5 h-5 bg-purple-100 rounded-full border border-purple-500 flex items-center justify-center z-20">
                         <Users size={10} className="text-purple-700" />
                      </div>
                   </div>
                )}

              </div>
            </div>
          );
        };


        const GroupHeader = ({ title, count, avgRSCA }) => (
          <div className="bg-slate-100 px-4 py-2 border-y border-slate-200 flex justify-between items-center">
            <div className="flex items-center space-x-2">
                <ChevronDown size={16} className="text-slate-500" />
                <h4 className="font-bold text-slate-700 text-sm uppercase tracking-wide">{title}</h4>
                <span className="bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full text-xs font-bold">{count}</span>
            </div>
            <div className="text-xs font-mono text-slate-500">
                Current Group Avg: <span className="font-bold text-slate-700">{avgRSCA}</span>
            </div>
          </div>
        );

        function NavfitInfinityApp() {
          const [activeTab, setActiveTab] = useState('officer');
          const [members, setMembers] = useState(INITIAL_MEMBERS);

          // Filter members based on tab
          const officerMembers = members.filter(m => m.rank.startsWith('O') || m.rank.startsWith('W'));
          const enlistedMembers = members.filter(m => m.rank.startsWith('E'));

          // Grouping Logic
          const groupMembers = (list) => {
            const groups = {};
            list.forEach(m => {
                // Group Key: Rank + Designator/Rating
                const key = `${m.rank} - ${m.designator || m.rating || ''}`;
                if (!groups[key]) groups[key] = [];
                groups[key].push(m);
            });
            return groups;
          };

          const currentList = activeTab === 'officer' ? officerMembers : enlistedMembers;
          const groups = groupMembers(currentList);

          return (
            <div className="min-h-screen bg-slate-50 flex font-sans text-slate-900">
              
              {/* Sidebar */}
              <div className="w-64 bg-slate-900 flex flex-col fixed h-full z-50 shadow-xl">
                {/* Logo Area */}
                <div className="h-20 flex items-center px-6 border-b border-slate-800">
                  <div className="relative">
                     <Anchor className="text-yellow-400 absolute -left-1 top-0" size={28} />
                     <Infinity className="text-blue-400 absolute left-2 top-2 opacity-80" size={16} />
                  </div>
                  <div className="ml-8">
                    <h1 className="text-white font-bold text-lg leading-none">NAVFIT</h1>
                    <span className="text-yellow-400 font-light text-sm tracking-[0.2em]">INFINITY</span>
                  </div>
                </div>

                {/* Navigation */}
                <div className="flex-1 py-6 space-y-1">
                  <SidebarItem icon={TrendingUp} label="Manning Waterfall" active />
                  <SidebarItem icon={FileText} label="Reports Manager" />
                  <SidebarItem icon={Users} label="Summary Groups" />
                  <SidebarItem icon={Calendar} label="Board Schedule" />
                </div>

                {/* Strategy Score in Sidebar */}
                <div className="p-6 bg-slate-800/50">
                    <div className="text-xs text-blue-300 uppercase font-semibold mb-2">RSCA Flexibility Score</div>
                    <div className="flex items-end space-x-2">
                        <span className="text-3xl font-bold text-green-400">84</span>
                        <span className="text-xs text-slate-400 mb-1">/ 100</span>
                    </div>
                    <div className="w-full bg-slate-700 h-1.5 rounded-full mt-2">
                        <div className="bg-green-400 h-1.5 rounded-full w-[84%]"></div>
                    </div>
                    <p className="text-[10px] text-slate-400 mt-2">High flexibility. You can support 2 additional EPs in the O-3 group.</p>
                </div>

                {/* User Profile */}
                <div className="p-4 border-t border-slate-800 flex items-center space-x-3">
                    <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold border-2 border-slate-700">
                        CO
                    </div>
                    <div>
                        <div className="text-sm font-bold text-white">CAPT J. Doe</div>
                        <div className="text-xs text-slate-400">Commanding Officer</div>
                    </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="ml-64 flex-1 flex flex-col">
                
                {/* Top Header */}
                <header className="h-16 bg-white border-b border-slate-200 flex justify-between items-center px-8 shadow-sm">
                    <h2 className="text-xl font-bold text-slate-800">Command Manning & RSCA Projection</h2>
                    <div className="flex items-center space-x-4">
                         <div className="flex items-center space-x-2 text-sm text-slate-600 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                            <Calendar size={14} />
                            <span>Year: {CURRENT_YEAR}</span>
                         </div>
                         <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center">
                            <Plus size={16} className="mr-2" />
                            New Report
                         </button>
                    </div>
                </header>

                {/* Dashboard Content */}
                <div className="p-8">
                    
                    {/* KPI Row */}
                    <div className="grid grid-cols-4 gap-6 mb-8">
                        <KPICard title="Pending Reports" value="12" subtext="3 require signature" color="blue" />
                        <KPICard title="Proj. O-3 RSCA" value="3.92" subtext="Current: 3.88 (+0.04)" trend="up" />
                        <KPICard title="Proj. E-6 RSCA" value="4.15" subtext="Current: 4.18 (-0.03)" trend="down" />
                        <KPICard title="Board Eligibility" value="8" subtext="Members 'In-Zone' next 6mo" color="red" />
                    </div>

                    {/* Waterfall Card */}
                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[600px]">
                        
                        {/* Waterfall Header Controls */}
                        <div className="p-4 border-b border-slate-200 flex justify-between items-center">
                            {/* Tabs */}
                            <div className="flex space-x-1 bg-slate-100 p-1 rounded-lg">
                                <button 
                                    onClick={() => setActiveTab('officer')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'officer' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    Officers (WARDROOM)
                                </button>
                                <button 
                                    onClick={() => setActiveTab('enlisted')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'enlisted' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    Enlisted (CPO MESS / CREW)
                                </button>
                            </div>

                            {/* Legend */}
                            <div className="flex items-center space-x-4 text-xs">
                                <div className="flex items-center space-x-1">
                                    <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <span className="text-slate-600">Periodic</span>
                                </div>
                                <div className="flex items-center space-x-1">
                                    <div className="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <span className="text-slate-600">Loss (Transfer)</span>
                                </div>
                                <div className="flex items-center space-x-1">
                                    <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span className="text-slate-600">Gain</span>
                                </div>
                                <div className="flex items-center space-x-1">
                                    <div className="w-0.5 h-4 bg-purple-500 border-l border-dashed border-purple-500"></div>
                                    <span className="text-slate-600">CO Detach (Sep 15)</span>
                                </div>
                            </div>
                        </div>

                        {/* Timeline Header (Months) */}
                        <div className="grid grid-cols-12 gap-4 bg-slate-50 py-2 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider">
                            <div className="col-span-3 pl-6">Member / Milestone</div>
                            <div className="col-span-2 text-center border-l border-r border-slate-200">Trait Trajectory</div>
                            <div className="col-span-7 grid grid-cols-12 text-center">
                                {MONTHS.map(m => (
                                    <div key={m} className="col-span-1">{m}</div>
                                ))}
                            </div>
                        </div>

                        {/* Content Groups */}
                        <div className="overflow-y-auto max-h-[600px]">
                            {Object.entries(groups).map(([groupTitle, groupList]) => (
                                <div key={groupTitle}>
                                    <GroupHeader 
                                        title={groupTitle} 
                                        count={groupList.length} 
                                        avgRSCA={(groupList.reduce((acc, curr) => acc + (curr.lastTrait || 0), 0) / (groupList.filter(m => m.lastTrait).length || 1)).toFixed(2)}
                                    />
                                    {groupList.map(member => (
                                        <TimelineRow 
                                            key={member.id} 
                                            member={member} 
                                            coDetachDate={CO_DETACH_DATE}
                                        />
                                    ))}
                                </div>
                            ))}
                            {Object.keys(groups).length === 0 && (
                                <div className="p-12 text-center text-slate-400">
                                    No members found for this category.
                                </div>
                            )}
                        </div>

                    </div>
                </div>
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<NavfitInfinityApp />);
    </script>
</body>
</html>